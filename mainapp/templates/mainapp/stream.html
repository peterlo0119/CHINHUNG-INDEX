{% extends "mainapp/layout.html" %}
{% block title %}ç›´æ’­è¿½è¹¤{% endblock %}
{% block content %}

<div style="text-align: right; margin-bottom: 10px;">
  <form method="post" action="{% url 'frontend_update_group' table %}">
    {% csrf_token %}
    <button type="submit" style="background-color:#ffcc00; padding:6px 12px; border-radius:5px; font-weight:bold;">
      ğŸ›  æ›´æ–°è³‡æ–™
    </button>
  </form>
</div>


<h1 style="text-align:center;">
  {% if table == 'hololive' %}ğŸ¬ Hololive ç›´æ’­æƒ…å ±
  {% elif table == 'nijisanji' %}ğŸ® ã«ã˜ã•ã‚“ã˜ ç›´æ’­æƒ…å ±
  {% elif table == 'aogiri' %}ğŸ« ã‚ãŠãã‚Šé«˜æ ¡ ç›´æ’­æƒ…å ±
  {% elif table == 'milpr' %}ğŸ¤ ãƒŸãƒªãƒ—ãƒ­ ç›´æ’­æƒ…å ±
  {% elif table == 'self' %}ğŸ  å€‹äººå‹¢ ç›´æ’­æƒ…å ±
  {% elif table == 'singer' %}ğŸ¤ Vsinger ç›´æ’­æƒ…å ±
  {% endif %}
</h1>

<div class="group-buttons">
    <a href="{% url 'stream' table %}" class="group-btn {% if not selected_group %}selected{% endif %}">å…¨éƒ¨</a>
    {% for g in groups %}
        <a href="{% url 'stream' table %}?group={{ g }}" class="group-btn {% if g == selected_group %}selected{% endif %}">
           {{ g }}
        </a>
    {% endfor %}
</div>

<div class="loader" id="loader">
  <span>ğŸ”„</span> è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...
</div>

{% for card in cards %}
<div class="card-flex">
  <div class="card-left">
    <a href="{{ card.url }}" target="_blank">
      <img class="card-avatar" src="{{ card.info.channel_avatar }}" alt="{{ card.name }}">
    </a>
    <p><strong>{{ card.name }}</strong></p>
  </div>

  <div class="card-right">
    <div class="video-block">
      <p><b>ğŸ¬ æœ€æ–°å½±ç‰‡ï¼š</b></p>
      <a href="{{ card.info.latest_video.url }}" target="_blank">
        <img class="thumb" src="{{ card.info.latest_video.thumbnail }}"><br>
        {{ card.info.latest_video.title }}
      </a>
      <p>ğŸ—“ ä¸Šå‚³æ™‚é–“ï¼š{{ card.info.latest_video.published_at }}</p>
      <p>â± é•·åº¦ï¼š{{ card.info.latest_video.duration }}</p>
      <p>ğŸ‘ è§€çœ‹æ•¸ï¼š{{ card.info.latest_video.view_count }}</p>
    </div>

    <div class="live-block">
      <p><b>ğŸ“¢ é è¨ˆç›´æ’­ï¼š</b></p>
        {% if card.info.live and card.info.live.start_time %}
            <a href="{{ card.info.live.url }}" target="_blank">
                <img class="thumb" src="{{ card.info.live.thumbnail }}"><br>
                {{ card.info.live.title }}
            </a>
            <p>ğŸ•’ é å®šé–‹å§‹ï¼š{{ card.info.live.start_time }}</p>
        {% else %}
            <div style="width:100%; max-width:300px; height:auto; background:#eee; border-radius:8px; padding:10px; text-align:center;">
                <p style="margin:0;">ç›®å‰æ²’æœ‰è¦åŠƒ</p>
            </div>
        {% endif %}
    </div>

  </div>
</div>

{% endfor %}
{% if latest_update %}
  <div style="text-align: right; margin-top: 30px; font-size: 14px; color: gray;">
    æœ€å¾Œæ›´æ–°æ™‚é–“ï¼š{{ latest_update|date:"Y-m-d H:i:s" }}
  </div>
{% endif %}

<script>
document.addEventListener("DOMContentLoaded", function () {
  const groupLinks = document.querySelectorAll('.group-btn');
  const loader = document.getElementById('loader');
  groupLinks.forEach(link => {
    link.addEventListener('click', () => {
      loader.style.display = 'block';
    });
  });
});
</script>
{% endblock %}
